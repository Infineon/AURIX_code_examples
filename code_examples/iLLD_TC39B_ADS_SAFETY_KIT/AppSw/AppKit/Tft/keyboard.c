/**********************************************************************************************************************
 * \file keyboard.c
 * \copyright Copyright (C) Infineon Technologies AG 2019
 *
 * Use of this file is subject to the terms of use agreed between (i) you or the company in which ordinary course of
 * business you are acting and (ii) Infineon Technologies AG or its licensees. If and as long as no such terms of use
 * are agreed, use of this file is subject to following:
 *
 * Boost Software License - Version 1.0 - August 17th, 2003
 *
 * Permission is hereby granted, free of charge, to any person or organization obtaining a copy of the software and
 * accompanying documentation covered by this license (the "Software") to use, reproduce, display, distribute, execute,
 * and transmit the Software, and to prepare derivative works of the Software, and to permit third-parties to whom the
 * Software is furnished to do so, all subject to the following:
 *
 * The copyright notices in the Software and this entire statement, including the above license grant, this restriction
 * and the following disclaimer, must be included in all copies of the Software, in whole or in part, and all
 * derivative works of the Software, unless such copies or derivative works are solely in the form of
 * machine-executable object code generated by a source language processor.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
 * COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN
 * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *********************************************************************************************************************/

/******************************************************************************/
/*----------------------------------Includes----------------------------------*/
/******************************************************************************/

#include <Cpu/Std/Ifx_Types.h>
#include <Cpu/Std/IfxCpu_Intrinsics.h>
#include "Configuration.h"
#include "conio_tft.h"
#include "touch.h"
#include <string.h>
#include <stdio.h>

/******************************************************************************/
/*------------------------Inline Function Prototypes--------------------------*/
/******************************************************************************/

/******************************************************************************/
/*-----------------------------------Macros-----------------------------------*/
/******************************************************************************/
//specific entries, contains the amount of entries for keyboard selection, e.g letters, space ...
#define MAX_DISPLAYKEYBENTRY 61
//the keyboard window is a window, which will be shown if scanf is exececuted
#define TERMINAL_KEYBOARD_MAXX TERMINAL_MAXX    //the maximum keyboard width
#define TERMINAL_KEYBOARD_MAXY 13   //the maximum keyboard height

/******************************************************************************/
/*-------------------------Function Prototypes--------------------------------*/
/******************************************************************************/
void keyboard_select_enter (sint32 ind, TDISPLAYENTRY * pdisplayentry); //special call backs for enter
void keyboard_select_left (sint32 ind, TDISPLAYENTRY * pdisplayentry);  //special call backs for left
void keyboard_select_right (sint32 ind, TDISPLAYENTRY * pdisplayentry);
void keyboard_select_back (sint32 ind, TDISPLAYENTRY * pdisplayentry);
void keyboard_display_descr (sint32 ind, TDISPLAYENTRY * pdisplayentry);    //shows the descr of the keyboard
void keyboard_display_text (sint32 ind, TDISPLAYENTRY * pdisplayentry); //shows the text for input modification
void keyboard_display (sint32 ind, TDISPLAYENTRY * pdisplayentry);
sint32 keyboard_input (sint32 ind, TDISPLAYENTRY * pdisplayentry);
void keyboard_select (sint32 ind, TDISPLAYENTRY * pdisplayentry);

/******************************************************************************/
/*------------------------Private Variables/Constants-------------------------*/
/******************************************************************************/
// *INDENT-OFF*
const uint8 keyboard_outline[TERMINAL_KEYBOARD_MAXY][TERMINAL_KEYBOARD_MAXX] = {
{0xDA, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC2, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xBF},
{0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3},
{0xC3, 0xC4, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC1, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC4, 0xC4, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC2, 0xC4, 0xC4, 0xB4},
{0xB3, 0x20, '^', 0xB3, '1', 0xB3, '2', 0xB3, '3', 0xB3, '4', 0xB3, '5', 0xB3, '6', 0xB3, '7', 0xB3, '8', 0xB3, '9', 0xB3, '0', 0xB3, 0x5C, 0xB3, 0x27, 0xB3, 'B', 'A', 'C', 'K', 0xB3, 0x11, 0xB3, 0x10, 0xB3, 0x00, 0x00, 0xB3},
{0xC3, 0xC4, 0xC4, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC4, 0xC4, 0xC4, 0xC5, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC4, 0xB4},
{0xB3, 'T', 'A', 'B', 0xB3, 'Q', 0xB3, 'W', 0xB3, 'E', 0xB3, 'R', 0xB3, 'T', 0xB3, 'Z', 0xB3, 'U', 0xB3, 'I', 0xB3, 'O', 0xB3, 'P', 0xB3, 0x9A, 0xB3, '+', 0xB3, 0x1B, 0xD9, 0x00, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3},
{0xC3, 0xC4, 0xC4, 0xC4, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xBF, 0x00, 0x00, 0xC3, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xB4},
{0xB3, 0x19, 0x00, 0x00, 0x00, 0xB3, 'A', 0xB3, 'S', 0xB3, 'D', 0xB3, 'F', 0xB3, 'G', 0xB3, 'H', 0xB3, 'J', 0xB3, 'K', 0xB3, 'L', 0xB3, 0x99, 0xB3, 0x8E, 0xB3, '#', 0xB3, 0x00, 0x00, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3},
{0xC3, 0xC4, 0xC4, 0xC4, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC2, 0xC1, 0xC4, 0xC1, 0xC4, 0xC4, 0xC5, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xB4},
{0xB3, 0x18, 0x00, 0x00, 0xB3, '>', 0xB3, 'Y', 0xB3, 'X', 0xB3, 'C', 0xB3, 'V', 0xB3, 'B', 0xB3, 'N', 0xB3, 'M', 0xB3, ',', 0xB3, '.', 0xB3, '-', 0xB3, 0x18, 0x00, 0x00, 0x00, 0x00, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3},
{0xC3, 0xC4, 0xC4, 0xC4, 0xC1, 0xC4, 0xC1, 0xC2, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC4, 0xC1, 0xC2, 0xC1, 0xC4, 0xC1, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC1, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xB4},
{0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xDB, 0xB3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB3},
{0xC0, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC1, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC1, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xD9}
};


const TDISPLAYENTRY keyboardlist[MAX_DISPLAYKEYBENTRY] = {
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 1, 19, 7, &keyboard_display_descr, &keyboard_display_descr, &keyboard_input, "DESCR", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_CYAN, 21, 39, 7, &keyboard_display_text, &keyboard_display_text, &keyboard_input, "TEXT", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 2, 2, 9, &keyboard_select, &keyboard_display, &keyboard_input, "^", '^'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 4, 4, 9, &keyboard_select, &keyboard_display, &keyboard_input, "1", '1'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 6, 6, 9, &keyboard_select, &keyboard_display, &keyboard_input, "2",  '2'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 8, 8, 9, &keyboard_select, &keyboard_display, &keyboard_input, "3",  '3'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 10, 10, 9, &keyboard_select, &keyboard_display, &keyboard_input, "4", '4'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 12, 12, 9, &keyboard_select, &keyboard_display, &keyboard_input, "5", '5'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 14, 14, 9, &keyboard_select, &keyboard_display, &keyboard_input, "6", '6'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 16, 16, 9, &keyboard_select, &keyboard_display, &keyboard_input, "7", '7'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 18, 18, 9, &keyboard_select, &keyboard_display, &keyboard_input, "8", '8'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 20, 20, 9, &keyboard_select, &keyboard_display, &keyboard_input, "9", '9'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 22, 22, 9, &keyboard_select, &keyboard_display, &keyboard_input, "0", '0'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 24, 24, 9, &keyboard_select, &keyboard_display, &keyboard_input, "\x0", 0x40},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 26, 26, 9, &keyboard_select, &keyboard_display, &keyboard_input, "\x0", 0x40},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 28, 31, 9, &keyboard_select_back, &keyboard_display, &keyboard_input, "BACK", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 33, 33, 9, &keyboard_select_left, &keyboard_display, &keyboard_input, "LEFT", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 35, 35, 9, &keyboard_select_right, &keyboard_display, &keyboard_input, "RIGHT", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 1, 3, 11, &keyboard_select, &keyboard_display, &keyboard_input, "TAB", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 5, 5, 11, &keyboard_select, &keyboard_display, &keyboard_input, "Q", 'Q'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 7, 7, 11, &keyboard_select, &keyboard_display, &keyboard_input, "W", 'W'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 9, 9, 11, &keyboard_select, &keyboard_display, &keyboard_input, "E", 'E'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 11, 11, 11, &keyboard_select, &keyboard_display, &keyboard_input, "R", 'R'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 13, 13, 11, &keyboard_select, &keyboard_display, &keyboard_input, "T", 'T'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 15, 15, 11, &keyboard_select, &keyboard_display, &keyboard_input, "Z", 'Z'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 17, 17, 11, &keyboard_select, &keyboard_display, &keyboard_input, "U", 'U'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 19, 19, 11, &keyboard_select, &keyboard_display, &keyboard_input, "I", 'I'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 21, 21, 11, &keyboard_select, &keyboard_display, &keyboard_input, "O", 'O'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 23, 23, 11, &keyboard_select, &keyboard_display, &keyboard_input, "P", 'P'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 25, 25, 11, &keyboard_select, &keyboard_display, &keyboard_input, "Ü", 0x9A},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 27, 27, 11, &keyboard_select, &keyboard_display, &keyboard_input, "+", '+'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 29, 31, 11, &keyboard_select_enter, &keyboard_display, &keyboard_input, "ENTER", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 30, 31, 12, &keyboard_select_enter, &keyboard_display, &keyboard_input, "ENTER", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 1, 4, 13, &keyboard_select, &keyboard_display, &keyboard_input, "CAPS", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 6, 6, 13, &keyboard_select, &keyboard_display, &keyboard_input, "A", 'A'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 8, 8, 13, &keyboard_select, &keyboard_display, &keyboard_input, "S", 'S'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 10, 10, 13, &keyboard_select, &keyboard_display, &keyboard_input, "D", 'D'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 12, 12, 13, &keyboard_select, &keyboard_display, &keyboard_input, "F", 'F'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 14, 14, 13, &keyboard_select, &keyboard_display, &keyboard_input, "G", 'G'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 16, 16, 13, &keyboard_select, &keyboard_display, &keyboard_input, "H", 'H'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 18, 18, 13, &keyboard_select, &keyboard_display, &keyboard_input, "J", 'J'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 20, 20, 13, &keyboard_select, &keyboard_display, &keyboard_input, "K", 'K'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 22, 22, 13, &keyboard_select, &keyboard_display, &keyboard_input, "L", 'L'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 24, 24, 13, &keyboard_select, &keyboard_display, &keyboard_input, "Ö", 0x99},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 26, 26, 13, &keyboard_select, &keyboard_display, &keyboard_input, "Ä", 0x8E},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 28, 28, 13, &keyboard_select, &keyboard_display, &keyboard_input, "#", '#'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 30, 31, 13, &keyboard_select_enter, &keyboard_display, &keyboard_input, "ENTER", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 1, 3, 15, &keyboard_select, &keyboard_display, &keyboard_input, "SHI", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 5, 5, 15, &keyboard_select, &keyboard_display, &keyboard_input, "<", '<'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 7, 7, 15, &keyboard_select, &keyboard_display, &keyboard_input, "Y", 'Y'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 9, 9, 15, &keyboard_select, &keyboard_display, &keyboard_input, "X", 'X'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 11, 11, 15, &keyboard_select, &keyboard_display, &keyboard_input, "C", 'C'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 13, 13, 15, &keyboard_select, &keyboard_display, &keyboard_input, "V", 'V'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 15, 15, 15, &keyboard_select, &keyboard_display, &keyboard_input, "B", 'B'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 17, 17, 15, &keyboard_select, &keyboard_display, &keyboard_input, "N", 'N'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 19, 19, 15, &keyboard_select, &keyboard_display, &keyboard_input, "M", 'M'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 21, 21, 15, &keyboard_select, &keyboard_display, &keyboard_input, ",", ','},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 23, 23, 15, &keyboard_select, &keyboard_display, &keyboard_input, ".", '.'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 25, 25, 15, &keyboard_select, &keyboard_display, &keyboard_input, "-", '-'},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 27, 31, 15, &keyboard_select, &keyboard_display, &keyboard_input, "SHI", 0x0},
{(COLOR_CYAN << 4) | COLOR_BLACK, (COLOR_BLACK << 4) | COLOR_YELLOW, 8, 22, 17, &keyboard_select, &keyboard_display, &keyboard_input, "SPACE", ' '}
};
// *INDENT-ON*
/******************************************************************************/
/*------------------------------Global variables------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*-------------------------Function Implementations---------------------------*/
/******************************************************************************/

void keyboard_display (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    sint32 j;
    for (j = keyboardlist[ind].xmin; j <= keyboardlist[ind].xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, keyboardlist[ind].y);
        conio_ascii_textchangecolor (conio_driver.displaymode, keyboardlist[ind].color_display);
    }
}

sint32 keyboard_input (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    __debug ();
    return (0);
}

void keyboard_select (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    sint32 j;
    for (j = keyboardlist[ind].xmin; j <= keyboardlist[ind].xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, keyboardlist[ind].y);
        conio_ascii_textchangecolor (conio_driver.displaymode, keyboardlist[ind].color_select);
    }
    if ((touch_driver.touchmode & MASK_TOUCH_UP) != 0)
    {
        touch_driver.touchmode &= ~MASK_TOUCH_UP;   //clear
        if (keyboardlist[ind].symbol != 0)
        {
            if (conio_driver.scanfx < 18)
            {
                j = strlen ((char *)conio_driver.scanftext);
                if (j < 18)
                {
                    while (j >= conio_driver.scanfx)
                    {
                        conio_driver.scanftext[j + 1] = conio_driver.scanftext[j];
                        j -= 1;
                    }
                }
                conio_driver.scanftext[conio_driver.scanfx] = keyboardlist[ind].symbol;
                conio_driver.scanfx += 1;
            }
        }
    }
}

void keyboard_select_enter (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    uint32 j;
    for (j = keyboardlist[ind].xmin; j <= keyboardlist[ind].xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, keyboardlist[ind].y);
        conio_ascii_textchangecolor (conio_driver.displaymode, keyboardlist[ind].color_select);
    }
    if ((touch_driver.touchmode & MASK_TOUCH_UP) != 0)
    {
        touch_driver.touchmode &= ~MASK_TOUCH_UP;   //clear
        if (conio_driver.input (conio_driver.inputid, pdisplayentry) == 0)
        {
            conio_driver.dialogmode = DIALOGOFF;

        }
    }
}

void keyboard_select_back (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    uint32 i, j;
    for (j = keyboardlist[ind].xmin; j <= keyboardlist[ind].xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, keyboardlist[ind].y);
        conio_ascii_textchangecolor (conio_driver.displaymode, keyboardlist[ind].color_select);
    }
    if ((touch_driver.touchmode & MASK_TOUCH_UP) != 0)
    {
        touch_driver.touchmode &= ~MASK_TOUCH_UP;   //clear
        if (conio_driver.scanfx > 0)
        {
            i = strlen ((char *)conio_driver.scanftext);
            for (j = conio_driver.scanfx - 1; j < i; j += 1)
            {
                conio_driver.scanftext[j] = conio_driver.scanftext[j + 1];
            }
            conio_driver.scanfx -= 1;
        }
    }
}

void keyboard_select_left (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    uint32 j;
    for (j = pdisplayentry->xmin; j <= pdisplayentry->xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, pdisplayentry->y);
        conio_ascii_textchangecolor (conio_driver.displaymode, pdisplayentry->color_select);
    }
    if ((touch_driver.touchmode & MASK_TOUCH_UP) != 0)
    {
        touch_driver.touchmode &= ~MASK_TOUCH_UP;   //clear
        if (conio_driver.scanfx > 0)
            conio_driver.scanfx -= 1;
    }
}

void keyboard_select_right (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    uint32 j;
    for (j = pdisplayentry->xmin; j <= pdisplayentry->xmax; j += 1)
    {
        conio_ascii_gotoxy (conio_driver.displaymode, j, pdisplayentry->y);
        conio_ascii_textchangecolor (conio_driver.displaymode, pdisplayentry->color_select);
    }
    if ((touch_driver.touchmode & MASK_TOUCH_UP) != 0)
    {
        touch_driver.touchmode &= ~MASK_TOUCH_UP;   //clear
        if (conio_driver.scanfx < 19)
            conio_driver.scanfx += 1;
    }
}

void keyboard_display_descr (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    conio_ascii_textattr (conio_driver.displaymode, pdisplayentry->color_display);
    conio_ascii_gotoxy (conio_driver.displaymode, pdisplayentry->xmin, pdisplayentry->y);
    conio_ascii_cputs (conio_driver.displaymode, conio_driver.scanfdescr);
}

void keyboard_display_text (sint32 ind, TDISPLAYENTRY * pdisplayentry)
{
    conio_ascii_textattr (conio_driver.displaymode, pdisplayentry->color_display);
    conio_ascii_gotoxy (conio_driver.displaymode, pdisplayentry->xmin, pdisplayentry->y);
    conio_ascii_cputs (conio_driver.displaymode, conio_driver.scanftext);
    conio_ascii_gotoxy (conio_driver.displaymode, conio_driver.scanfx + pdisplayentry->xmin, pdisplayentry->y);
    if ((conio_driver.blinky & 1) == 0)
        conio_ascii_textchangecolor (conio_driver.displaymode, pdisplayentry->color_select);
}


void keyboard (sint16 x, sint16 y)
{
    sint32 i, j;
    sint32 eofstr;

    //KEYBOARD x,y alignment
    if (y < 7)
        y = 7;
    if (y > 17)
        y = 17;

    conio_ascii_textcolor (DISPLAYMENU, COLOR_BLACK);
    conio_ascii_textbackground (DISPLAYMENU, COLOR_CYAN);

    conio_ascii_gotoxy (conio_driver.displaymode, 0, 6);
    for (j = 0; j < 13; j += 1)
        for (i = 0; i < 40; i += 1)
        {
            conio_ascii_putch (conio_driver.displaymode, keyboard_outline[j][i]);
        }
    conio_ascii_gotoxy (conio_driver.displaymode, 1, 7);
    eofstr = 0;
    for (j = 0; j < 18; j += 1)
    {
        if (conio_driver.scanfdescr[j] == 0)
            eofstr = 1;
        if (eofstr == 0)
            conio_ascii_putch (conio_driver.displaymode, conio_driver.scanfdescr[0]);
        else
            conio_ascii_putch (conio_driver.displaymode, 0x20);
    }
    conio_ascii_gotoxy (conio_driver.displaymode, 21, 7);
    eofstr = 0;
    for (j = 0; j < 18; j += 1)
    {
        if (conio_driver.scanftext[j] == 0)
            eofstr = 1;
        if (eofstr == 0)
            conio_ascii_putch (conio_driver.displaymode, conio_driver.scanftext[0]);
        else
            conio_ascii_putch (conio_driver.displaymode, 0x20);
    }
    conio_ascii_gotoxy (DISPLAYMENU, x, y);
    conio_ascii_textchangebackground (DISPLAYMENU, COLOR_RED);
    for (i = 0; i < MAX_DISPLAYKEYBENTRY; i += 1)
    {
        if ((x >= keyboardlist[i].xmin) && (x <= keyboardlist[i].xmax) && (y == keyboardlist[i].y))
        {
            keyboardlist[i].select (i, (struct DISPLAYENTRY *) &keyboardlist[i]);
        }
        else
        {
            keyboardlist[i].display (i, (struct DISPLAYENTRY *) &keyboardlist[i]);
        }
    }
}
