/**********************************************************************************************************************
 * \file ifx_hsphy.c
 * \copyright Copyright (C) Infineon Technologies AG 2019
 *
 * Use of this file is subject to the terms of use agreed between (i) you or the company in which ordinary course of
 * business you are acting and (ii) Infineon Technologies AG or its licensees. If and as long as no such terms of use
 * are agreed, use of this file is subject to following:
 *
 * Boost Software License - Version 1.0 - August 17th, 2003
 *
 * Permission is hereby granted, free of charge, to any person or organization obtaining a copy of the software and
 * accompanying documentation covered by this license (the "Software") to use, reproduce, display, distribute, execute,
 * and transmit the Software, and to prepare derivative works of the Software, and to permit third-parties to whom the
 * Software is furnished to do so, all subject to the following:
 *
 * The copyright notices in the Software and this entire statement, including the above license grant, this restriction
 * and the following disclaimer, must be included in all copies of the Software, in whole or in part, and all
 * derivative works of the Software, unless such copies or derivative works are solely in the form of
 * machine-executable object code generated by a source language processor.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
 * COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN
 * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *********************************************************************************************************************/

 #include "pdl/ifx_hsphy.h"

#include "Stm/Std/IfxStm.h"

#define HSPHY_PHY_READ                  1
#define HSPHY_PHY_WRITE                 2

/* HSPHY_CRPARA domain */
#define SUP_ANA_MPLLA_TEST1             0x00A2
#define RAWCMN_DIG_AON_CMNCAL_STATUS    0x4050

static sint32 HSPHY_XPCS_EnableMPLL(uint8 idx);
static sint32 HSPHY_XPCS_DisableMPLL(uint8 idx);
static sint32 HSPHY_XPCS_Start(uint8 idx);

static sint32 HSPHY_XPCS_SetSerialSpeed125M(uint8 idx);
static sint32 HSPHY_XPCS_SetSerialSpeed1G25(uint8 idx);
static sint32 HSPHY_XPCS_SetSerialSpeed3G125(uint8 idx);
static sint32 HSPHY_XPCS_SetSerialSpeed5G15625(uint8 idx);

static sint32 HSPHY_XPCS_SetModeUSXGMII_5000(uint8 idx);
static sint32 HSPHY_XPCS_SetModeSGMII_2500(uint8 idx);
static sint32 HSPHY_XPCS_SetModeSGMII_1000(uint8 idx);
static sint32 HSPHY_XPCS_SetModeSGMII_100_1G25(uint8 idx);
static sint32 HSPHY_XPCS_SetModeSGMII_100_125M(uint8 idx);

sint32 HSPHY_Init(void)
{
    MODULE_HSPHY.CLC.U &= ~GENMASK(IFX_HSPHY_CLC_DISR);
    while (MODULE_HSPHY.CLC.B.DISS != 0);

    return 0;
}

#if defined(HSPHY_ETH0) || defined(HSPHY_ETH1)
sint32 HSPHY_ETH_Init(uint8 idx, Ifx_HSPHY_ETH_Bits config)
{
    MODULE_HSPHY.ETH[idx].B = config;
    if ((config.EPR == HSPHY_ETH_EPR_RGMII) || (config.EPR == HSPHY_ETH_EPR_RMII))
    {
        MODULE_HSPHY.CMNCFG.B.FSR = 1;
    }
    else
    {
        MODULE_HSPHY.CMNCFG.B.FSR = 0;
    }

    return 0;
}
#endif

sint32 HSPHY_PHY_Init(uint8 idx, sint32 function)
{
    MODULE_HSPHY.PHY[idx].CTRL1.B.PWRDWN = 0;
    IfxStm_waitTicks(&MODULE_CPU0, IfxStm_getTicksFromMicroseconds(100));

    IFX_ASSERT(IFX_VERBOSE_LEVEL_ERROR,
               ((idx == 0) && ((function == HSPHY_PHY_ETH) || (function == HSPHY_PHY_PCIE))) ||
               ((idx == 1) && (function == HSPHY_PHY_ETH)) ||
               ((idx == 2) && (function == HSPHY_PHY_PCIE)));

    uint32 regval = MODULE_HSPHY.PHY[idx].CTRL1.U;
    regval &= ~(GENMASK(IFX_HSPHY_MP8GPHY_CTRL1_PRS) | GENMASK(IFX_HSPHY_MP8GPHY_CTRL1_FSP));
    if (idx == 0)
    {
        regval |= VAL2FLD(IFX_HSPHY_MP8GPHY_CTRL1_FSP, function);
    }

    MODULE_HSPHY.PHY[idx].CTRL1.U = regval;

    MODULE_HSPHY.PHY[idx].CTRL1.B.RST = 0;

    while (MODULE_HSPHY.PHY[idx].CTRL1.B.INITDONE == 0);
    MODULE_HSPHY.PHY[idx].CTRL1.B.EXTLDDONE = 1;
    MODULE_HSPHY.PHY[idx].CTRL1.B.BLDBYP = 1;

    /* For an improved jitter performance, but only for the 25 MHz refclk case, set bit [14:13] in register mplla testmodes register to 01D */
    MODULE_HSPHY.PHYREG[idx].CTRL.B = (Ifx_HSPHY_PHYREG_CTRL_Bits){
        .ADDR = SUP_ANA_MPLLA_TEST1,
        .TYP = HSPHY_PHY_READ,
        .ACT = 1
    };
    while (MODULE_HSPHY.PHYREG[idx].CTRL.B.ACT != 0);

    uint16 mplla_testmode = MODULE_HSPHY.PHYREG[idx].DATA.B.DATA;
    mplla_testmode &= (uint32_t)~0x6000;
    mplla_testmode |= (uint32_t)0x2000;
    MODULE_HSPHY.PHYREG[idx].DATA.B.DATA = mplla_testmode;

    MODULE_HSPHY.PHYREG[idx].CTRL.B = (Ifx_HSPHY_PHYREG_CTRL_Bits){
        .ADDR = SUP_ANA_MPLLA_TEST1,
        .TYP = HSPHY_PHY_WRITE,
        .ACT = 1
    };
    while (MODULE_HSPHY.PHYREG[idx].CTRL.B.ACT != 0);

    /* The end of the initialization phase is indicated by the RAWCMN_DIG_AON_CMNCAL_STATUS register in the HSPHY */
    Ifx_HSPHY_PHY_RAWCMN_DIG_AON_CMNCAL_STATUS cal_status;

    uint32 phyreg_ctrl = VAL2FLD(IFX_HSPHY_PHYREG_CTRL_ADDR, RAWCMN_DIG_AON_CMNCAL_STATUS) |
                         VAL2FLD(IFX_HSPHY_PHYREG_CTRL_TYP, HSPHY_PHY_READ) |
                         VAL2FLD(IFX_HSPHY_PHYREG_CTRL_ACT, 1);
    do
    {
        MODULE_HSPHY.PHYREG[idx].CTRL.U = phyreg_ctrl;
        while (MODULE_HSPHY.PHYREG[idx].CTRL.B.ACT != 0);

        cal_status.U = MODULE_HSPHY.PHYREG[idx].DATA.B.DATA;

    } while ((cal_status.B.CMNCAL_INIT == 0) || cal_status.B.CMNCAL_DONE == 0);

    return 0;
}


sint32 HSPHY_XPCS_Init(uint8 idx, sint32 mode)
{
    switch (mode)
    {
        case HSPHY_XPCS_MODE_USXGMII_5000:
            HSPHY_XPCS_SetModeUSXGMII_5000(idx);
            break;

        case HSPHY_XPCS_MODE_SGMII_2500:
            HSPHY_XPCS_SetModeSGMII_2500(idx);
            break;

        case HSPHY_XPCS_MODE_SGMII_1000:
            HSPHY_XPCS_SetModeSGMII_1000(idx);
            break;

        case HSPHY_XPCS_MODE_SGMII_100_1G25:
            HSPHY_XPCS_SetModeSGMII_100_1G25(idx);
            break;

        case HSPHY_XPCS_MODE_SGMII_100_125M:
            HSPHY_XPCS_SetModeSGMII_100_125M(idx);
            break;

        default:
            return -1;
    }

    return 0;
}

sint32 HSPHY_XPCS_DisableMPLL(uint8 idx)
{
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_MPLL_CMN_CTRL.B.MPLL_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX_REQ_0 = 1;
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX_REQ_0 != 0);
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_STS.B.TX_ACK_0 != 0);

    return 0;
}

sint32 HSPHY_XPCS_EnableMPLL(uint8 idx)
{
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_MPLL_CMN_CTRL.B.MPLL_EN_0 = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX_REQ_0 = 1;
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX_REQ_0 != 0);
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_STS.B.TX_ACK_0 != 0);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX_REQ_0 = 1;
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX_REQ_0 != 0);
    while (MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_STS.B.RX_ACK_0 != 0);

    return 0;
}

sint32 HSPHY_XPCS_Start(uint8 idx)
{
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.INIT = 1;
    while (MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.INIT != 0);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.TX_CLK_RDY_0 = 0;

    uint32 regval = MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL1.U;
    regval |= GENMASK(IFX_HSPHY_XPCS_PCS_SR_XS_CTRL1_LPM);
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL1.U = regval;
    while (MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_STS.B.PSEQ_STATE != 6);
    regval &= ~GENMASK(IFX_HSPHY_XPCS_PCS_SR_XS_CTRL1_LPM);
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL1.U = regval;
    while (MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_STS.B.PSEQ_STATE != 4);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.TX_CLK_RDY_0 = 1;

    return 0;
}

sint32 HSPHY_XPCS_SetSerialSpeed125M(uint8 idx)
{
    /* Configure PHY to operate at 1.25Gbps serial line rate. Assuming 25MHz ref. clock */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL0.B.MPLLA_MULTIPLIER = 50;

    uint32 regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV) |
                GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_DIV16P5_CLK_EN));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV, 3);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U = regval;

    regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP) | GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP, 12) | VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT, 2);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL7.B.CP_PROP_GS = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_MPLLA_CTRL1.B.MPLLA_FRACN_CTRL = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_VCO_CAL_LD0.B.VCO_LD_VAL_0 = 1000;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_VCO_CAL_REF0.B.VCO_REF_LD_0 = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_MISC_CTRL2.B.SUP_MISC = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_DIV16P5_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_GENCTRL4.B.RX_125MHZ_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_RATE_CTRL.B.TX0_RATE = 2;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_RATE_CTRL.B.RX0_RATE = 2;
    /*  [HSPHY_TC.005] Loss of Receive Ethernet communication during temperature change */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_MISC_CTRL0.B.RX0_MISC = 177;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_BOOST_CTRL.B.TX0_IBOOST = 15;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.VBOOST_EN_0 = 0;
    /* End configure PHY serial line rate */

    return 0;
}

sint32 HSPHY_XPCS_SetSerialSpeed1G25(uint8 idx)
{
    /* Configure PHY to operate at 1.25Gbps serial line rate. Assuming 25MHz ref. clock */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL0.B.MPLLA_MULTIPLIER = 50;

    uint32 regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV) |
                GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_DIV16P5_CLK_EN));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV, 1);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U = regval;

    regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP) | 
                GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP, 12) | 
              VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT, 2);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL7.B.CP_PROP_GS = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_MPLLA_CTRL1.B.MPLLA_FRACN_CTRL = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_VCO_CAL_LD0.B.VCO_LD_VAL_0 = 1000;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_VCO_CAL_REF0.B.VCO_REF_LD_0 = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_MISC_CTRL2.B.SUP_MISC = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_DIV16P5_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_GENCTRL4.B.RX_125MHZ_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_RATE_CTRL.B.TX0_RATE = 2;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_RATE_CTRL.B.RX0_RATE = 2;
    /*  [HSPHY_TC.005] Loss of Receive Ethernet communication during temperature change */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_MISC_CTRL0.B.RX0_MISC = 161;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_BOOST_CTRL.B.TX0_IBOOST = 15;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.VBOOST_EN_0 = 0;
    /* End configure PHY serial line rate */

    return 0;
}

sint32 HSPHY_XPCS_SetSerialSpeed3G125(uint8 idx)
{
    /* Configure PHY to operate at 3.125Gbps serial line rate. Assuming 25MHz ref. clock */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL0.B.MPLLA_MULTIPLIER = 125;

    uint32 regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV) |
                GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_DIV16P5_CLK_EN));
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U = regval;

    regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP) | GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP, 12) | VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT, 2);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL7.B.CP_PROP_GS = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_MPLLA_CTRL1.B.MPLLA_FRACN_CTRL = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_VCO_CAL_LD0.B.VCO_LD_VAL_0 = 1000;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_VCO_CAL_REF0.B.VCO_REF_LD_0 = 8;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_MISC_CTRL2.B.SUP_MISC = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_DIV16P5_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_GENCTRL4.B.RX_125MHZ_CLK_EN_0 = 0;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_RATE_CTRL.B.TX0_RATE = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_RATE_CTRL.B.RX0_RATE = 1;
    /*  [HSPHY_TC.005] Loss of Receive Ethernet communication during temperature change */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_MISC_CTRL0.B.RX0_MISC = 96;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX0_WIDTH = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_BOOST_CTRL.B.TX0_IBOOST = 15;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.VBOOST_EN_0 = 0;
    /* End configure PHY serial line rate */

    return 0;
}

sint32 HSPHY_XPCS_SetSerialSpeed5G15625(uint8 idx)
{
    /* Configure PHY to operate at 5.15625Gbps serial line rate. Assuming 25MHz ref. clock */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL0.B.MPLLA_MULTIPLIER = 103;

    uint32 regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U;
    regval &= ~GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV);
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_TX_CLK_DIV, 3) |
              GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_12G_16G_MPLLA_CTRL2_MPLLA_DIV16P5_CLK_EN);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_MPLLA_CTRL2.U = regval;

    regval = MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U;
    regval &= ~(GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP) | GENMASK(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT));
    regval |= VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_PROP, 12) | VAL2FLD(IFX_HSPHY_XPCS_PMA_VR_XS_MP_8G_MPLLA_CTRL6_CP_INT, 2);
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL6.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_8G_MPLLA_CTRL7.B.CP_PROP_GS = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_MPLLA_CTRL1.B.MPLLA_FRACN_CTRL = 390;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_VCO_CAL_LD0.B.VCO_LD_VAL_0 = 1031;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_VCO_CAL_REF0.B.VCO_REF_LD_0 = 10;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_MISC_CTRL2.B.SUP_MISC = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_DIV16P5_CLK_EN_0 = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_GENCTRL4.B.RX_125MHZ_CLK_EN_0 = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_RATE_CTRL.B.TX0_RATE = 1;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_RATE_CTRL.B.RX0_RATE = 0;
    /*  [HSPHY_TC.005] Loss of Receive Ethernet communication during temperature change */
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_16G_25G_RX_MISC_CTRL0.B.RX0_MISC = 163;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_TX_GENCTRL2.B.TX0_WIDTH = 3;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_RX_GENCTRL2.B.RX0_WIDTH = 3;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_BOOST_CTRL.B.TX0_IBOOST = 12;
    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_TX_GENCTRL1.B.VBOOST_EN_0 = 1;
    // End configure serial line rate

    return 0;
}


sint32 HSPHY_XPCS_SetModeSGMII_1000(uint8 idx)
{
    HSPHY_XPCS_DisableMPLL(idx);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 1;

    /* select 10GBASE-X PCS Type */
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL2.B.PCS_TYPE_SEL = 1;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_KR_CTRL.B.USXG_MODE = 0;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.EN_2_5G_MODE = 0;

    /* set speed to 1G, SS6=1,SS13=0 */
    uint32 regval = MODULE_HSPHY.XPCS[idx].MII.CTRL.U;
    regval &= ~GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS13);
    regval |= GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS6);
    MODULE_HSPHY.XPCS[idx].MII.CTRL.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 0;

    HSPHY_XPCS_SetSerialSpeed1G25(idx);

    HSPHY_XPCS_EnableMPLL(idx);

    HSPHY_XPCS_Start(idx);

    return 0;
}


sint32 HSPHY_XPCS_SetModeUSXGMII_5000(uint8 idx)
{
    HSPHY_XPCS_DisableMPLL(idx);

    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.USXG_EN = 1;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_KR_CTRL.B.USXG_MODE = 1;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.EN_2_5G_MODE = 0;

    HSPHY_XPCS_SetSerialSpeed5G15625(idx);

    HSPHY_XPCS_EnableMPLL(idx);

    HSPHY_XPCS_Start(idx);

    /* set speed to 5G, SS5=1,SS6=0,SS13=1 */
    uint32 regval = MODULE_HSPHY.XPCS[idx].MII.CTRL.U;
    regval |= GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS13) | GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS5);
    regval &= ~GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS6);
    MODULE_HSPHY.XPCS[idx].MII.CTRL.U = regval;

    IfxStm_waitTicks(&MODULE_CPU0, IfxStm_getTicksFromMicroseconds(10));

    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.USRA_RST = 1;
    while (MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.USRA_RST != 0);

    return 0;
}

sint32 HSPHY_XPCS_SetModeSGMII_2500(uint8 idx)
{
    HSPHY_XPCS_DisableMPLL(idx);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 1;

    /* select 10GBASE-X PCS Type */
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL2.B.PCS_TYPE_SEL = 1;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_KR_CTRL.B.USXG_MODE = 0;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.EN_2_5G_MODE = 1;

    /* set speed to 1G, SS6=1,SS13=0 */
    uint32 regval = MODULE_HSPHY.XPCS[idx].MII.CTRL.U;
    regval &= ~GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS13);
    regval |= GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS6);
    MODULE_HSPHY.XPCS[idx].MII.CTRL.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 0;

    HSPHY_XPCS_SetSerialSpeed3G125(idx);

    HSPHY_XPCS_EnableMPLL(idx);

    HSPHY_XPCS_Start(idx);

    return 0;
}

sint32 HSPHY_XPCS_SetModeSGMII_100_1G25(uint8 idx)
{
    HSPHY_XPCS_DisableMPLL(idx);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 1;

    /* select 10GBASE-X PCS Type */
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL2.B.PCS_TYPE_SEL = 1;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_KR_CTRL.B.USXG_MODE = 0;
    MODULE_HSPHY.XPCS[idx].PCS.VR_XS_DIG_CTRL1.B.EN_2_5G_MODE = 0;

    // set speed to 100M, SS6=0,SS13=1
    uint32 regval = MODULE_HSPHY.XPCS[idx].MII.CTRL.U;
    regval |= GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS13);
    regval &= ~GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS6);
    MODULE_HSPHY.XPCS[idx].MII.CTRL.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 0;

    HSPHY_XPCS_SetSerialSpeed1G25(idx);

    HSPHY_XPCS_EnableMPLL(idx);

    HSPHY_XPCS_Start(idx);

    return 0;
}

sint32 HSPHY_XPCS_SetModeSGMII_100_125M(uint8 idx)
{
    HSPHY_XPCS_DisableMPLL(idx);

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 1;

    /* select 10GBASE-X PCS Type */
    MODULE_HSPHY.XPCS[idx].PCS.SR_XS_CTRL2.B.PCS_TYPE_SEL = 1;
    MODULE_HSPHY.XPCS[idx].MII.DIG_CTRL1.B.EN_100M = 1;

    // set speed to 100M, SS6=0,SS13=1
    uint32 regval = MODULE_HSPHY.XPCS[idx].MII.CTRL.U;
    regval |= GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS13);
    regval &= ~GENMASK(IFX_HSPHY_XPCS_MII_CTRL_SS6);
    MODULE_HSPHY.XPCS[idx].MII.CTRL.U = regval;

    MODULE_HSPHY.XPCS[idx].PMA.VR_XS_MP_12G_16G_25G_RX_GENCTRL1.B.RX_RST_0 = 0;

    HSPHY_XPCS_SetSerialSpeed125M(idx);

    HSPHY_XPCS_EnableMPLL(idx);

    HSPHY_XPCS_Start(idx);

    return 0;
}
